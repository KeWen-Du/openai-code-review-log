### ä»£ç å˜æ›´è®°å½• git diff
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/bak/OpenAiCodeReviewBak.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/bak/OpenAiCodeReviewBak.java
deleted file mode 100644
index 78c8199..0000000
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/bak/OpenAiCodeReviewBak.java
+++ /dev/null
@@ -1,164 +0,0 @@
-package dkw.middleware.sdk.bak;
-
-import com.alibaba.fastjson2.JSON;
-import dkw.middleware.sdk.infrastructure.openai.dto.ChatCompletionRequestDTO;
-import dkw.middleware.sdk.infrastructure.openai.dto.ChatCompletionSyncResponseDTO;
-import dkw.middleware.sdk.infrastructure.weixin.dto.TemplateMessageDTO;
-import dkw.middleware.sdk.domain.model.Model;
-import dkw.middleware.sdk.types.utils.BearerTokenUtils;
-import dkw.middleware.sdk.types.utils.HttpUtils;
-import dkw.middleware.sdk.types.utils.RandomStringUtils;
-import dkw.middleware.sdk.types.utils.WXAccessTokenUtils;
-import org.eclipse.jgit.api.Git;
-import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider;
-
-import java.io.*;
-import java.net.HttpURLConnection;
-import java.net.URL;
-import java.nio.charset.StandardCharsets;
-import java.text.SimpleDateFormat;
-import java.util.ArrayList;
-import java.util.Date;
-
-
-public class OpenAiCodeReviewBak {
-//    public static void main(String[] args) throws Exception {
-//        System.out.println("openaiä»£ç è¯„å®¡ æµ‹è¯•æ‰§è¡Œ");
-//
-//        String token = System.getenv("GITHUB_TOKENS");
-//        if (null == token || token.isEmpty()) {
-//            throw new RuntimeException("token is null");
-//        }
-//        //ä»£ç æ£€å‡º
-//        ProcessBuilder processBuilder = new ProcessBuilder("git", "diff", "HEAD~1", "HEAD");
-//
-//        Process process = processBuilder.start();
-//
-//        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
-//        String line;
-//
-//        StringBuffer diffCode = new StringBuffer();
-//        while ((line = bufferedReader.readLine()) != null) {
-//            diffCode.append(line);
-//        }
-//
-//        int exitCode = process.waitFor();
-//        System.out.println("exit code=" + exitCode);
-//        System.out.println("diff code=\r\n" + diffCode);
-//
-//        //ä»£ç è¯„å®¡
-//        String log = codeReview(diffCode.toString());
-//        System.out.println("code review log:\r\n" + log);
-//
-//        //å†™å…¥æ—¥å¿—
-//        String logUrl = writeLog(token, log, diffCode.toString());
-//        System.out.println("write log to:\r\n" + logUrl);
-//
-//        //æ¶ˆæ¯é€šçŸ¥
-//        System.out.println("pushMessageï¼š" + logUrl);
-//        pushMessage(logUrl);
-//
-//    }
-
-    private static void pushMessage(String logUrl) {
-        String accessToken = WXAccessTokenUtils.getAccessToken();
-        System.out.println(accessToken);
-
-        TemplateMessageDTO templateMessage = new TemplateMessageDTO();
-        templateMessage.put("project", "openai-code-review-9139-dkw");
-        templateMessage.put("review", logUrl);
-        templateMessage.setTemplateJumpUrl(logUrl);
-
-        String url = String.format("https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=%s", accessToken);
-        System.out.println(JSON.toJSONString(templateMessage));
-        HttpUtils.sendPostRequest(url, JSON.toJSONString(templateMessage));
-    }
-
-
-    private static String codeReview(String diffCode) throws Exception {
-        String ak = "8751544afb8b574a2d3a717bed8bf86e.NR9C8vqi6DIhbSJh";
-        String token = BearerTokenUtils.getToken(ak);
-
-        URL url = new URL("https://open.bigmodel.cn/api/paas/v4/chat/completions");
-        HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();
-
-        httpURLConnection.setRequestMethod("POST");
-        httpURLConnection.setRequestProperty("Authorization", "Bearer " + token);
-        httpURLConnection.setRequestProperty("Content-Type", "application/json");
-        httpURLConnection.setRequestProperty("User-Agent", "Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)");
-        httpURLConnection.setDoOutput(true);
-
-        ChatCompletionRequestDTO chatCompletionRequestDTO = new ChatCompletionRequestDTO();
-        chatCompletionRequestDTO.setModel(Model.GLM_4_FLASH.getCode());
-        chatCompletionRequestDTO.setMessages(new ArrayList<ChatCompletionRequestDTO.Prompt>() {
-            private static final long serialVersionUID = -7988151926241837899L;
-
-            {
-                add(new ChatCompletionRequestDTO.Prompt("user", "ä½ æ˜¯ä¸€ä¸ªé«˜çº§ç¼–ç¨‹æ¶æ„å¸ˆï¼Œç²¾é€šå„ç±»åœºæ™¯æ–¹æ¡ˆã€æ¶æ„è®¾è®¡å’Œç¼–ç¨‹è¯­è¨€è¯·ï¼Œè¯·æ‚¨æ ¹æ®git diffè®°å½•ï¼Œå¯¹ä»£ç åšå‡ºè¯„å®¡ã€‚ä»£ç å¦‚ä¸‹:"));
-                add(new ChatCompletionRequestDTO.Prompt("user", diffCode));
-            }
-        });
-
-        try (OutputStream outputStream = httpURLConnection.getOutputStream()) {
-            byte[] bytes = JSON.toJSONString(chatCompletionRequestDTO).getBytes(StandardCharsets.UTF_8);
-            outputStream.write(bytes);
-        }
-
-        int responseCode = httpURLConnection.getResponseCode();
-        System.out.println(responseCode);
-        String responseMessage = httpURLConnection.getResponseMessage();
-        System.out.println(responseMessage);
-
-        BufferedReader in = new BufferedReader(new InputStreamReader(httpURLConnection.getInputStream()));
-        String inputLine;
-
-        StringBuffer content = new StringBuffer();
-        while ((inputLine = in.readLine()) != null) {
-            content.append(inputLine);
-        }
-
-        in.close();
-        httpURLConnection.disconnect();
-
-        System.out.println("è¯„å®¡ç»“æœï¼š" + content.toString());
-
-
-        ChatCompletionSyncResponseDTO response = JSON.parseObject(content.toString(), ChatCompletionSyncResponseDTO.class);
-        System.out.println(response.getChoices().get(0).getMessage().getContent());
-        return response.getChoices().get(0).getMessage().getContent();
-    }
-
-    private static String writeLog(String token, String log, String diffCodeStr) throws Exception {
-
-        Git gitRepo = Git.cloneRepository()
-                .setURI("https://github.com/KeWen-Du/openai-code-review-log.git")
-                .setDirectory(new File("repo"))
-                .setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, ""))
-                .call();
-
-        String dateFolderName = new SimpleDateFormat("yyyy-MM-dd").format(new Date());
-        File dateFolder = new File("repo/" + dateFolderName);
-        if (!dateFolder.exists()) {
-            dateFolder.mkdirs();
-        }
-        String fileNameStr = RandomStringUtils.generateRandomString(12) + ".md";
-        String fileNamePre = new SimpleDateFormat("HH_mm_ss").format(new Date());
-        String fileName = fileNamePre + "_" + fileNameStr;
-        File newFile = new File(dateFolder, fileName);
-
-        try (FileWriter writer = new FileWriter(newFile)) {
-            writer.write("### ä»£ç å˜æ›´è®°å½• git diff\r\n");
-            writer.write(diffCodeStr + "\r\n\r\n");
-            writer.write(log);
-        }
-
-        gitRepo.add().addFilepattern(dateFolderName + "/" + fileName).call();
-        gitRepo.commit().setMessage("Add new file via GitHub Actions").call();
-        gitRepo.push().setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, "")).call();
-
-        System.out.println("Changes have been pushed to the repository.");
-
-        return "https://github.com/KeWen-Du/openai-code-review-log/blob/master/" + dateFolderName + "/" + fileName;
-    }
-
-}
\ No newline at end of file
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/domain/service/impl/OpenAiCodeReviewService.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/domain/service/impl/OpenAiCodeReviewService.java
index 558915a..738935c 100644
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/domain/service/impl/OpenAiCodeReviewService.java
+++ b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/domain/service/impl/OpenAiCodeReviewService.java
@@ -84,5 +84,7 @@ public class OpenAiCodeReviewService extends AbstractOpenAiCodeReviewService {
         TemplateMessageDTO.put(templateData, TemplateMessageDTO.TemplateKey.BRANCH_NAME,gitCommand.getBranch());
         TemplateMessageDTO.put(templateData, TemplateMessageDTO.TemplateKey.COMMIT_AUTHOR,gitCommand.getAuthor());
         TemplateMessageDTO.put(templateData, TemplateMessageDTO.TemplateKey.COMMIT_MESSAGE,gitCommand.getMessage());
+
+        weiXin.sendTemplateMessage(logUrl, templateData);
     }
 }
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/git/GitCommand.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/git/GitCommand.java
index 876cbed..796efdc 100644
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/git/GitCommand.java
+++ b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/git/GitCommand.java
@@ -73,7 +73,7 @@ public class GitCommand {
 
 
         // åˆ›å»ºProcessBuilderå¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œgit diffå‘½ä»¤ï¼Œè·å–æœ€è¿‘ä¸€æ¬¡æäº¤çš„å·®å¼‚
-        ProcessBuilder diffProcessBuilder = new ProcessBuilder("git", "diff", lastCommitHash+"^", lastCommitHash);
+        ProcessBuilder diffProcessBuilder = new ProcessBuilder("git", "diff", lastCommitHash + "^", lastCommitHash);
         // è®¾ç½®ProcessBuilderçš„å·¥ä½œç›®å½•ä¸ºå½“å‰ç›®å½•
         diffProcessBuilder.directory(new File("."));
         // å¯åŠ¨è¿›ç¨‹
@@ -93,7 +93,7 @@ public class GitCommand {
         // ç­‰å¾…è¿›ç¨‹ç»“æŸï¼Œå¹¶è·å–é€€å‡ºç 
         int exitCode = diffProcess.waitFor();
         // å¦‚æœé€€å‡ºç ä¸ä¸º0ï¼Œè¡¨ç¤ºgit diffå‘½ä»¤æ‰§è¡Œå¤±è´¥
-        if (exitCode!=0) {
+        if (exitCode != 0) {
             throw new RuntimeException("Failed to get diff, exit code:" + exitCode);
         }
         logger.info("diffCode:{}", diffCode);
@@ -104,7 +104,7 @@ public class GitCommand {
     public String writeLog(String reviewResult, String diffCodeStr) throws Exception {
 
         Git gitRepo = Git.cloneRepository()
-                .setURI(githubReviewLogUri+".git")
+                .setURI(githubReviewLogUri + ".git")
                 .setDirectory(new File("repo"))
                 .setCredentialsProvider(new UsernamePasswordCredentialsProvider(githubToken, ""))
                 .call();
@@ -115,7 +115,7 @@ public class GitCommand {
             dateFolder.mkdirs();
         }
 
-        String fileName = project+"-"+branch+"-"+author+System.currentTimeMillis()+"-"+RandomStringUtils.generateRandomString(4);
+        String fileName = project + "-" + branch + "-" + author + System.currentTimeMillis() + "-" + RandomStringUtils.generateRandomString(4);
         File newFile = new File(dateFolder, fileName);
 
         try (FileWriter writer = new FileWriter(newFile)) {
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/openai/impl/ChatGLM.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/openai/impl/ChatGLM.java
index de1bdab..d89c7d5 100644
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/openai/impl/ChatGLM.java
+++ b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/openai/impl/ChatGLM.java
@@ -29,9 +29,6 @@ public class ChatGLM implements IOpenAI {
 
     @Override
     public ChatCompletionSyncResponseDTO completions(ChatCompletionRequestDTO requestDTO) throws Exception {
-//        String ak = "8751544afb8b574a2d3a717bed8bf86e.NR9C8vqi6DIhbSJh";
-//        URL url = new URL("https://open.bigmodel.cn/api/paas/v4/chat/completions");
-
         String chatGLMToken = BearerTokenUtils.getToken(apiKeySecret);
         URL url = new URL(apiHost);
 
@@ -62,7 +59,7 @@ public class ChatGLM implements IOpenAI {
 
         in.close();
         httpURLConnection.disconnect();
-        System.out.println("è¯„å®¡ç»“æœï¼š" + content.toString());
+        System.out.println("è¯„å®¡ç»“æœï¼š" + content);
 
 
         return JSON.parseObject(content.toString(), ChatCompletionSyncResponseDTO.class);
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/WeiXin.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/WeiXin.java
index fb67d80..71d008d 100644
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/WeiXin.java
+++ b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/WeiXin.java
@@ -1,6 +1,7 @@
 package dkw.middleware.sdk.infrastructure.weixin;
 
 import com.alibaba.fastjson2.JSON;
+import dkw.middleware.sdk.infrastructure.git.GitCommand;
 import dkw.middleware.sdk.infrastructure.weixin.dto.TemplateMessageDTO;
 import dkw.middleware.sdk.types.utils.HttpUtils;
 import dkw.middleware.sdk.types.utils.WXAccessTokenUtils;
@@ -31,8 +32,6 @@ public class WeiXin {
         TemplateMessageDTO templateMessageDTO = new TemplateMessageDTO(userWeixinToken, template_id);
         templateMessageDTO.setTemplateJumpUrl(logUrl);
         templateMessageDTO.setTemplateData(data);
-        templateMessageDTO.put("project", "openai-code-review-9139-dkw");
-        templateMessageDTO.put("review", logUrl);
 
         String url = String.format("https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=%s", accessToken);
         System.out.println(JSON.toJSONString(templateMessageDTO));
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/dto/TemplateMessageDTO.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/dto/TemplateMessageDTO.java
index 5a99bc8..12f09ee 100644
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/dto/TemplateMessageDTO.java
+++ b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/infrastructure/weixin/dto/TemplateMessageDTO.java
@@ -15,18 +15,6 @@ public class TemplateMessageDTO {
         this.template_id = template_id;
     }
 
-    public TemplateMessageDTO() {
-    }
-
-    public void put(String key, String value) {
-        templateData.put(key, new HashMap<String, String>() {
-            private static final long serialVersionUID = 7092338402387318563L;
-
-            {
-                put("value", value);
-            }
-        });
-    }
 
     public static void put(Map<String,Map<String,String>> data,TemplateKey key,String value){
         data.put(key.getCode(), new HashMap<String, String>() {


# DKWé¡¹ç›®ï¼š OpenAi ä»£ç è¯„å®¡.
### ğŸ˜€ä»£ç è¯„åˆ†ï¼š70
#### ğŸ˜€ä»£ç é€»è¾‘ä¸ç›®çš„ï¼š
è¯¥ä»£ç åº“ä¼¼ä¹æ˜¯ä¸€ä¸ªç”¨äºä»£ç å®¡æŸ¥çš„æ¡†æ¶ï¼Œå®ƒåŒ…æ‹¬ä¸OpenAIå’Œå¾®ä¿¡APIäº¤äº’çš„åŠŸèƒ½ï¼Œä»¥åŠä¸GitHubçš„é›†æˆã€‚ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡GitHubçš„commitå·®å¼‚å’ŒOpenAIçš„æ¨¡å‹æ¥ç”Ÿæˆä»£ç å®¡æŸ¥çš„æ—¥å¿—ï¼Œå¹¶å°†ç»“æœå‘é€åˆ°å¾®ä¿¡ã€‚

#### ğŸ¤”é—®é¢˜ç‚¹ï¼š
1. **ä»£ç ç»“æ„**ï¼šä»£ç ç»“æ„ä¸å¤Ÿæ¸…æ™°ï¼Œç±»å’Œæ–¹æ³•ä¹‹é—´ç¼ºä¹æ˜ç¡®çš„èŒè´£åˆ’åˆ†ã€‚
2. **æ€§èƒ½ç“¶é¢ˆ**ï¼šå­˜åœ¨å¤šæ¬¡ç½‘ç»œè¯·æ±‚å’Œæ–‡ä»¶æ“ä½œï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½ä¼˜åŒ–æªæ–½ã€‚
3. **å¼‚å¸¸å¤„ç†**ï¼šå¼‚å¸¸å¤„ç†ä¸å¤Ÿå®Œå–„ï¼Œæœ‰äº›å…³é”®æ“ä½œæ²¡æœ‰è¿›è¡Œå¼‚å¸¸æ•è·ã€‚
4. **å®‰å…¨é£é™©**ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚tokenï¼‰ç›´æ¥å­˜å‚¨åœ¨ä»£ç ä¸­ï¼Œå­˜åœ¨æ³„éœ²é£é™©ã€‚
5. **ä»£ç é£æ ¼**ï¼šä»£ç é£æ ¼ä¸ä¸€è‡´ï¼Œæ³¨é‡Šä¸è¶³ã€‚
6. **è¾¹ç•Œæ¡ä»¶**ï¼šåœ¨æ–‡ä»¶æ“ä½œå’Œç½‘ç»œè¯·æ±‚ä¸­æ²¡æœ‰è€ƒè™‘åˆ°è¾¹ç•Œæ¡ä»¶ã€‚

#### ğŸ¯ä¿®æ”¹å»ºè®®ï¼š
1. **é‡æ„ä»£ç ç»“æ„**ï¼šå°†åŠŸèƒ½æ¨¡å—åˆ†ç¦»ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚å’Œæ–‡ä»¶æ“ä½œï¼Œä½¿ç”¨ç¼“å­˜æœºåˆ¶ã€‚
3. **å®Œå–„å¼‚å¸¸å¤„ç†**ï¼šåœ¨å…³é”®æ“ä½œä¸­æ·»åŠ å¼‚å¸¸æ•è·å’Œå¤„ç†ã€‚
4. **å®‰å…¨æªæ–½**ï¼šæ•æ„Ÿä¿¡æ¯åº”è¯¥å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ã€‚
5. **æ”¹è¿›ä»£ç é£æ ¼**ï¼šç»Ÿä¸€ä»£ç é£æ ¼ï¼Œæ·»åŠ å¿…è¦çš„æ³¨é‡Šã€‚
6. **è€ƒè™‘è¾¹ç•Œæ¡ä»¶**ï¼šåœ¨æ–‡ä»¶æ“ä½œå’Œç½‘ç»œè¯·æ±‚ä¸­æ·»åŠ è¾¹ç•Œæ¡ä»¶çš„æ£€æŸ¥ã€‚

#### ğŸ’»ä¿®æ”¹åçš„ä»£ç ï¼š
ç”±äºä»£ç é‡è¾ƒå¤§ï¼Œæ— æ³•åœ¨æ­¤å¤„å±•ç¤ºæ‰€æœ‰ä¿®æ”¹åçš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•é‡æ„ä¸€ä¸ªæ–¹æ³•ä»¥æé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š

```java
public class OpenAiCodeReviewBak {
    // ...

    private static String performCodeReview(String diffCode) throws Exception {
        String reviewResult = null;
        try {
            String token = BearerTokenUtils.getToken(apiKeySecret);
            URL url = new URL(apiHost);
            HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();
            // ... è®¾ç½®HTTPè¿æ¥å±æ€§
            // ... å‘é€è¯·æ±‚å¹¶è·å–å“åº”
            // ... å¤„ç†å“åº”
            reviewResult = response.getChoices().get(0).getMessage().getContent();
        } catch (IOException e) {
            // å¤„ç†IOException
        } catch (Exception e) {
            // å¤„ç†å…¶ä»–å¼‚å¸¸
        }
        return reviewResult;
    }
}
```

#### ä»£ç ä¸­çš„ä¼˜ç‚¹ï¼š
- ä»£ç é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£ã€‚
- ä½¿ç”¨äº†try-catchå—æ¥å¤„ç†å¯èƒ½çš„å¼‚å¸¸æƒ…å†µã€‚

#### ä»£ç çš„é€»è¾‘å’Œç›®çš„ï¼š
ä¸Šè¿°ä¿®æ”¹åçš„ä»£ç ç¤ºä¾‹æ—¨åœ¨é€šè¿‡å°è£…HTTPè¯·æ±‚å’Œå¤„ç†é€»è¾‘ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å®ƒå°†å¤æ‚çš„é€»è¾‘å°è£…åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—ä¸»æ–¹æ³•æ›´åŠ ç®€æ´ã€‚