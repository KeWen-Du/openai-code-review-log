### ä»£ç å˜æ›´è®°å½• git diff
diff --git a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/OpenAiCodeReview.java b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/OpenAiCodeReview.java
index bec4f78..bb363c2 100644
--- a/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/OpenAiCodeReview.java
+++ b/openai-code-review-sdk/src/main/java/dkw/middleware/sdk/OpenAiCodeReview.java
@@ -42,7 +42,7 @@ public class OpenAiCodeReview {
         logger.info("openai-code-review done!");
     }
 
-    public static String getEnv(String key) {
+    private static String getEnv(String key) {
         String value = System.getenv(key);
         if (null == value || value.isEmpty()) {
             throw new RuntimeException(key + " value is null");
diff --git a/openai-code-review-sdk/src/test/java/dkw/middleware/sdk/test/ApiTest.java b/openai-code-review-sdk/src/test/java/dkw/middleware/sdk/test/ApiTest.java
index 85913ce..fc841ea 100644
--- a/openai-code-review-sdk/src/test/java/dkw/middleware/sdk/test/ApiTest.java
+++ b/openai-code-review-sdk/src/test/java/dkw/middleware/sdk/test/ApiTest.java
@@ -1,22 +1,7 @@
 package dkw.middleware.sdk.test;
 
-import com.alibaba.fastjson2.JSON;
-import dkw.middleware.sdk.infrastructure.openai.dto.ChatCompletionSyncResponseDTO;
 import dkw.middleware.sdk.types.utils.BearerTokenUtils;
-import dkw.middleware.sdk.types.utils.WXAccessTokenUtils;
-import org.junit.Test;
 
-import java.io.BufferedReader;
-import java.io.InputStreamReader;
-import java.io.OutputStream;
-import java.net.HttpURLConnection;
-import java.net.URL;
-import java.nio.charset.StandardCharsets;
-import java.util.HashMap;
-import java.util.Map;
-import java.util.Scanner;
-
-import static dkw.middleware.sdk.OpenAiCodeReview.getEnv;
 
 public class ApiTest {
 
@@ -26,144 +11,4 @@ public class ApiTest {
         System.out.println(token);
     }
 
-    @Test
-    public void test_http() throws Exception {
-        String ak = "8751544afb8b574a2d3a717bed8bf86e.NR9C8vqi6DIhbSJh";
-        String token = BearerTokenUtils.getToken(ak);
-
-        URL url = new URL("https://open.bigmodel.cn/api/paas/v4/chat/completions");
-        HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();
-
-        httpURLConnection.setRequestMethod("POST");
-        httpURLConnection.setRequestProperty("Authorization", "Bearer " + token);
-        httpURLConnection.setRequestProperty("Content-Type", "application/json");
-        httpURLConnection.setRequestProperty("User-Agent", "Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)");
-        httpURLConnection.setDoOutput(true);
-
-        String code = "1+1";
-
-        String jsonInpuString = "{"
-                + "\"model\":\"glm-4-flash\","
-                + "\"messages\": ["
-                + "    {"
-                + "        \"role\": \"user\","
-                + "        \"content\": \"ä½ æ˜¯ä¸€ä¸ªé«˜çº§ç¼–ç¨‹æ¶æ„å¸ˆï¼Œç²¾é€šå„ç±»åœºæ™¯æ–¹æ¡ˆã€æ¶æ„è®¾è®¡å’Œç¼–ç¨‹è¯­è¨€è¯·ï¼Œè¯·æ‚¨æ ¹æ®git diffè®°å½•ï¼Œå¯¹ä»£ç åšå‡ºè¯„å®¡ã€‚ä»£ç ä¸º: " + code + "\""
-                + "    }"
-                + "]"
-                + "}";
-
-        try (OutputStream outputStream = httpURLConnection.getOutputStream()) {
-            byte[] bytes = jsonInpuString.getBytes(StandardCharsets.UTF_8);
-            outputStream.write(bytes);
-        }
-
-        int responseCode = httpURLConnection.getResponseCode();
-        System.out.println(responseCode);
-        String responseMessage = httpURLConnection.getResponseMessage();
-        System.out.println(responseMessage);
-
-        BufferedReader in = new BufferedReader(new InputStreamReader(httpURLConnection.getInputStream()));
-        String inputLine;
-
-        StringBuffer content = new StringBuffer();
-        while ((inputLine = in.readLine()) != null) {
-            content.append(inputLine);
-        }
-
-        in.close();
-        httpURLConnection.disconnect();
-        System.out.println(content.toString());
-
-
-        ChatCompletionSyncResponseDTO response = JSON.parseObject(content.toString(), ChatCompletionSyncResponseDTO.class);
-        System.out.println(response.getChoices().get(0).getMessage().getContent());
-    }
-
-    @Test
-    public void test_wx() {
-        String accessToken = WXAccessTokenUtils.getAccessToken(getEnv("WEIXIN_APPID"), getEnv("WEIXIN_SECRET"));
-        System.out.println(accessToken);
-        Message message = new Message();
-        message.put("repo_name", "big-market");
-        message.put("branch_name", "feat: æ–°åŠ åŠŸèƒ½");
-        message.put("commit_author", "feat: æ–°åŠ åŠŸèƒ½");
-        message.put("commit_message", "feat: æ–°åŠ åŠŸèƒ½");
-
-        String url = String.format("https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=%s", accessToken);
-        System.out.println(JSON.toJSONString(message));
-        sendPostRequest(url, JSON.toJSONString(message));
-    }
-
-    private static void sendPostRequest(String urlString, String jsonBody) {
-        try {
-            URL url = new URL(urlString);
-            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
-            conn.setRequestMethod("POST");
-            conn.setRequestProperty("Content-Type", "application/json; utf-8");
-            conn.setRequestProperty("Accept", "application/json");
-            conn.setDoOutput(true);
-
-            try (OutputStream os = conn.getOutputStream()) {
-                byte[] input = jsonBody.getBytes(StandardCharsets.UTF_8);
-                os.write(input, 0, input.length);
-            }
-
-            try (Scanner scanner = new Scanner(conn.getInputStream(), StandardCharsets.UTF_8.name())) {
-                String response = scanner.useDelimiter("\\A").next();
-                System.out.println(response);
-            }
-        } catch (Exception e) {
-            e.printStackTrace();
-        }
-    }
-
-
-    public static class Message {
-        private String touser = "oavof6xGr7jIjnJ6PkO_9TGKnHD0";
-        private String template_id = "zAIi_1H4cu2Gs_G3ZuqqqwRapX1uft9AmmEaWJUsjN0";
-        private String url = "https://github.com/KeWen-Du/openai-code-review-log/blob/master/2024-08-09/M2xJzbMqMnjK.md";
-
-        private Map<String, Map<String, String>> data = new HashMap<>();
-
-        public void put(String key, String value) {
-            data.put(key, new HashMap<String, String>() {
-                {
-                    put("value", value);
-                }
-            });
-        }
-
-        public String getTouser() {
-            return touser;
-        }
-
-        public void setTouser(String touser) {
-            this.touser = touser;
-        }
-
-        public String getTemplate_id() {
-            return template_id;
-        }
-
-        public void setTemplate_id(String template_id) {
-            this.template_id = template_id;
-        }
-
-        public String getUrl() {
-            return url;
-        }
-
-        public void setUrl(String url) {
-            this.url = url;
-        }
-
-        public Map<String, Map<String, String>> getData() {
-            return data;
-        }
-
-        public void setData(Map<String, Map<String, String>> data) {
-            this.data = data;
-        }
-    }
-
 }


# DKWé¡¹ç›®ï¼š OpenAi ä»£ç è¯„å®¡.
### ğŸ˜€ä»£ç è¯„åˆ†ï¼š80
#### ğŸ˜€ä»£ç é€»è¾‘ä¸ç›®çš„ï¼š
è¯¥ä»£ç åº“ä¼¼ä¹æ˜¯ä¸€ä¸ªç”¨äºä»£ç å®¡æŸ¥çš„SDKï¼ŒåŒ…å«ç¯å¢ƒå˜é‡è·å–ã€HTTPè¯·æ±‚å‘é€ä»¥åŠå¾®ä¿¡æ¶ˆæ¯å‘é€ç­‰åŠŸèƒ½ã€‚ä»£ç çš„ä¸»è¦ç›®çš„æ˜¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œå…è®¸ç”¨æˆ·ä¸OpenAIæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œå‘é€ä»£ç å·®å¼‚è®°å½•ï¼Œå¹¶å¤„ç†å“åº”ã€‚

#### ğŸ¤”é—®é¢˜ç‚¹ï¼š
1. `getEnv` æ–¹æ³•æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒã€‚
2. æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨äº†ç¡¬ç¼–ç çš„APIå¯†é’¥å’Œç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µã€‚
3. `test_http` æ–¹æ³•ä¸­ä½¿ç”¨äº†å¤§é‡çš„æ—¥å¿—è¾“å‡ºï¼Œè¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚
4. `Message` ç±»ä¸­çš„ `data` å­—æ®µæ˜¯ä¸€ä¸ªåµŒå¥—çš„ `HashMap`ï¼Œè¿™ç§è®¾è®¡å¯èƒ½å¯¼è‡´ç»´æŠ¤å›°éš¾ã€‚
5. `sendPostRequest` æ–¹æ³•ä¸­çš„å¼‚å¸¸å¤„ç†ä¸å¤Ÿå…¨é¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ³„éœ²ã€‚

#### ğŸ¯ä¿®æ”¹å»ºè®®ï¼š
1. å°† `getEnv` æ–¹æ³•çš„å¼‚å¸¸å¤„ç†æ”¹ä¸ºè¿”å›é»˜è®¤å€¼æˆ–ç©ºå€¼ï¼Œé¿å…ç›´æ¥æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚
2. ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ã€‚
3. å‡å°‘æµ‹è¯•ä»£ç ä¸­çš„æ—¥å¿—è¾“å‡ºï¼Œæˆ–è€…åœ¨æµ‹è¯•ç¯å¢ƒä¸­è®¾ç½®ä¸åŒçš„æ—¥å¿—çº§åˆ«ã€‚
4. `Message` ç±»ä¸­çš„ `data` å­—æ®µå¯ä»¥ç®€åŒ–ä¸ºç›´æ¥ä½¿ç”¨ `Map`ï¼Œå‡å°‘åµŒå¥—ã€‚
5. åœ¨ `sendPostRequest` æ–¹æ³•ä¸­æ·»åŠ æ›´å…¨é¢çš„å¼‚å¸¸å¤„ç†ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚

#### ğŸ’»ä¿®æ”¹åçš„ä»£ç ï¼š
```java
// OpenAiCodeReview.java
public class OpenAiCodeReview {
    // ... å…¶ä»–ä»£ç  ...

    public static String getEnv(String key) {
        String value = System.getenv(key);
        if (value == null || value.isEmpty()) {
            return null; // æˆ–è€…ä½¿ç”¨é»˜è®¤å€¼
        }
        return value;
    }

    // ... å…¶ä»–ä»£ç  ...
}

// ApiTest.java
public class ApiTest {
    // ... å…¶ä»–ä»£ç  ...

    @Test
    public void test_http() throws Exception {
        // ... å…¶ä»–ä»£ç  ...

        // ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡è·å–token
        String token = BearerTokenUtils.getToken(getEnv("API_KEY"));

        // ... å…¶ä»–ä»£ç  ...
    }

    // ... å…¶ä»–ä»£ç  ...

    private static void sendPostRequest(String urlString, String jsonBody) {
        try {
            // ... å…¶ä»–ä»£ç  ...

            try (OutputStream os = conn.getOutputStream()) {
                byte[] input = jsonBody.getBytes(StandardCharsets.UTF_8);
                os.write(input, 0, input.length);
            }

            try (Scanner scanner = new Scanner(conn.getInputStream(), StandardCharsets.UTF_8.name())) {
                if (scanner.hasNext()) {
                    String response = scanner.useDelimiter("\\A").next();
                    System.out.println(response);
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
            // å…¶ä»–å¼‚å¸¸å¤„ç†é€»è¾‘
        } finally {
            if (conn != null) {
                conn.disconnect();
            }
        }
    }

    // ... å…¶ä»–ä»£ç  ...
}
```

#### ä»£ç ä¸­çš„ä¼˜ç‚¹ï¼š
- ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»å’Œç†è§£ã€‚
- ä½¿ç”¨äº†æ ‡å‡†çš„HTTPè¯·æ±‚æ–¹æ³•æ¥å‘é€æ•°æ®ã€‚
- å¼‚å¸¸å¤„ç†è¾ƒä¸ºåˆç†ã€‚